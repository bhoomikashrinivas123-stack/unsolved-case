<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Unsolved Case</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
background:linear-gradient(135deg,#1a1a2e,#16213e);
color:#e0e0e0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px
}
.container{max-width:1100px;width:100%;background:#0f3460;border-radius:12px;
display:grid;grid-template-columns:1fr 300px;overflow:hidden}
.main-content{padding:30px}
.sidebar{background:#0a1e35;padding:20px;border-left:2px solid #e94560}
h1{color:#e94560}
.room-title{color:#16c784;margin:10px 0}
.visual-clues{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:15px;margin-top:15px}
.clue-image{
background:rgba(255,255,255,.1);border:2px solid #16c784;border-radius:8px;
height:180px;display:flex;flex-direction:column;align-items:center;justify-content:center;
cursor:pointer;transition:.2s
}
.clue-image:hover{border-color:#e94560;transform:scale(1.05)}
.timer{
border:2px solid #e94560;padding:12px;border-radius:8px;text-align:center;
font-family:monospace;font-size:22px;margin-bottom:15px
}
input{padding:10px;border-radius:6px;border:2px solid #16c784;background:transparent;color:#fff;width:100%}
button{padding:10px 16px;background:#e94560;border:none;color:#fff;border-radius:6px;cursor:pointer;margin-top:10px}
.message.success{color:#16c784}
.message.error{color:#e94560}
.image-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);align-items:center;justify-content:center}
.image-modal.active{display:flex}
.modal-content{background:#0f3460;padding:30px;border-radius:10px;text-align:center;max-width:520px;position:relative}
.modal-close{position:absolute;top:10px;right:10px;background:#e94560;border:none;color:#fff;padding:5px 10px;border-radius:6px;cursor:pointer}
.evidence-item{margin-bottom:6px;font-size:14px}
.final-riddle{margin-top:30px;padding:20px;border:2px solid #16c784;border-radius:10px}
.hint-button{
  display:flex;align-items:center;margin-top:10px;cursor:pointer;color:#16c784;font-size:18px;
}
.hint-message{margin-top:6px;font-size:14px;color:#fff;font-style:italic}
.play-again{
  margin-top:20px;cursor:pointer;font-size:30px;color:#16c784;
}
</style>
</head>

<body>

<div class="container" id="gameContainer">
  <div class="main-content">
    <h1>üîç The Unsolved Case</h1>
    <div class="room-title" id="roomTitle"></div>
    <div class="timer" id="timerDisplay"></div>
    <div id="roomContent"></div>
  </div>

  <div class="sidebar">
    <p><strong>Room:</strong> <span id="roomNumber"></span></p>
    <p><strong>Hints used:</strong> <span id="hintsUsed">0</span></p>
    <p id="progressText">0% Complete</p>
    <h3 style="margin-top:15px">Evidence</h3>
    <div id="evidenceList"></div>
  </div>
</div>

<div class="image-modal" id="imageModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeImageModal()">X</button>
    <div id="modalImage" style="font-size:120px"></div>
    <div id="modalDescription" style="margin-top:10px"></div>
    <div id="modalActions"></div>
  </div>
</div>

<audio id="successSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
</audio>

<script>
/* ================= GAME DATA ================= */
const gameState={currentRoom:0,hintsUsed:0,solved:new Set(),evidence:new Set(),
timeRemaining:0,timer:null,roomFlags:{}};

const rooms=[
{
title:"Room 1: The Crime Scene",
timeLimit:300, // 5 minutes
story:"A diamond vanished. Investigate visual clues.",
visualClues:[
{emoji:"üìù",label:"Note Found",description:"Meet at 1_:3_"},
{emoji:"üïê",label:"Clock",description:"Clock shows 3:30 PM"},
{emoji:"üîí",label:"Safe Lock",description:"4-digit safe opened during gap"},
{emoji:"üìä",label:"Security Log",description:"Access recorded at 15:30"}
],
puzzle:{question:"What time was the diamond stolen? (HH:MM)",answer:"15:30"},
evidence:"Security Log Extract",
hint:"Check the clock and the note üïêüìù"
},
{
title:"Room 2: Suspect Interrogation",
timeLimit:180,
story:"Study suspects and alibis.",
visualClues:[
{emoji:"üë®",label:"Alex",description:"Left shop at 3:15"},
{emoji:"üëÆ",label:"Ben",description:"Watch time mismatched"},
{emoji:"üë©",label:"Clara",description:"Call forwarded at 3:15"},
{emoji:"üìπ",label:"Camera",description:"Blurred figure in guard jacket"}
],
puzzle:{question:"Who is lying? (Alex, Ben, Clara)",answer:"clara"},
evidence:"Phone Records",
hint:"Compare their alibis carefully"
},
{
title:"Room 3: The Final Code",
timeLimit:120,
story:"Combine everything to unlock the vault.",
visualClues:[
{emoji:"üèõ",label:"Digit 1",description:"One pillar"},
{emoji:"‚≠ê",label:"Digit 5",description:"Five-point star"},
{emoji:"üî∫",label:"Digit 3",description:"Three barriers"},
{emoji:"üîê",label:"Digit 0",description:"Round lock"}
],
puzzle:{question:"Enter the 4-digit code",answer:"1530"},
evidence:"Confession Evidence",
hint:"Use the digits you found in previous rooms"
}
];

/* ================= CORE LOGIC ================= */
function formatTime(s){
const m=Math.floor(s/60);
const sec=s%60;
return `${m}:${sec<10?"0":""}${sec}`;
}

function loadRoom(i){
if(i>=rooms.length){showFinalScreen();return;}
if(!gameState.roomFlags[i]){
gameState.roomFlags[i]={uvCooldown:0,uvInterval:null,noteRevealed:false,hintUsed:false};
}

gameState.currentRoom=i;
gameState.timeRemaining=rooms[i].timeLimit;

document.getElementById("roomTitle").textContent=rooms[i].title;
document.getElementById("roomNumber").textContent=`${i+1}/${rooms.length}`;

document.getElementById("roomContent").innerHTML=`
<p>${rooms[i].story}</p>

<div class="visual-clues">
${rooms[i].visualClues.map((c,idx)=>`
<div class="clue-image" onclick="openImageModal(${idx})">
<div style="font-size:60px">${c.emoji}</div>
<div>${c.label}</div>
</div>`).join("")}
</div>

<div style="margin-top:20px">
<p>${rooms[i].puzzle.question}</p>
<input id="answerInput"/>
<button onclick="submitAnswer()">Submit</button>
${!gameState.roomFlags[i].hintUsed?'<div class="hint-button" onclick="showHint()">üí° Hint</div>':''}
<div id="hintMsg" class="hint-message"></div>
<div id="message"></div>
</div>
`;

startTimer();
updateSidebar();
}

function startTimer(){
clearInterval(gameState.timer);
const d=document.getElementById("timerDisplay");
gameState.timer=setInterval(()=>{
gameState.timeRemaining--;
d.textContent=`‚è± ${formatTime(gameState.timeRemaining)}`;
if(gameState.timeRemaining<=0){
clearInterval(gameState.timer);
nextRoom();
}
},1000);
}

function submitAnswer(){
const v=document.getElementById("answerInput").value.trim().toLowerCase();
const r=rooms[gameState.currentRoom];
const m=document.getElementById("message");

if(v===r.puzzle.answer){
m.className="message success";
m.textContent="Correct!";
const sound = document.getElementById("successSound");
if(sound){sound.currentTime=0; sound.play().catch(()=>{});}
gameState.solved.add(gameState.currentRoom);
gameState.evidence.add(r.evidence);
setTimeout(nextRoom,800);
}else{
m.className="message error";
m.textContent="Incorrect! +30s penalty";
gameState.timeRemaining+=30;
}
updateSidebar();
}

function nextRoom(){
clearInterval(gameState.timer);
loadRoom(gameState.currentRoom+1);
}

/* ================= UV MECHANIC ================= */
function openImageModal(idx){
const roomIndex=gameState.currentRoom;
const clue=rooms[roomIndex].visualClues[idx];
const flags=gameState.roomFlags[roomIndex];

document.getElementById("modalImage").textContent=clue.emoji;
const desc=document.getElementById("modalDescription");
const actions=document.getElementById("modalActions");
actions.innerHTML="";

if(roomIndex===0 && clue.label==="Note Found"){
if(flags.noteRevealed){
desc.innerHTML="<strong>Revealed note:</strong> Meet at 15:30";
}else if(flags.uvCooldown>0){
desc.innerHTML=`${clue.description}<br><br>UV lamp warming: <strong>${flags.uvCooldown}s</strong>`;
}else{
desc.textContent=clue.description;
const btn=document.createElement("button");
btn.textContent="Inspect with UV Lamp";
btn.onclick=()=>startUV(roomIndex);
actions.appendChild(btn);
}
}else{
desc.textContent=clue.description;
}

document.getElementById("imageModal").classList.add("active");
}

function startUV(roomIndex){
const flags=gameState.roomFlags[roomIndex];
flags.uvCooldown=120;
flags.uvInterval=setInterval(()=>{
flags.uvCooldown--;
if(flags.uvCooldown<=0){
clearInterval(flags.uvInterval);
flags.noteRevealed=true;
const desc=document.getElementById("modalDescription");
desc.innerHTML="<strong>Revealed note:</strong> Meet at 15:30";
}
},1000);
}

function closeImageModal(){
document.getElementById("imageModal").classList.remove("active");
}

/* ================= HINT ================= */
function showHint(){
const r=rooms[gameState.currentRoom];
document.getElementById("hintMsg").textContent=r.hint;
gameState.hintsUsed++;
gameState.roomFlags[gameState.currentRoom].hintUsed = true;
// Deduct 1 min
gameState.timeRemaining = Math.max(gameState.timeRemaining - 60, 0);
updateSidebar();
// Remove the hint button
const hintBtn = document.querySelector(".hint-button");
if(hintBtn){hintBtn.remove();}
}

/* ================= FINAL SCREEN + RIDDLE ================= */
function showFinalScreen(){
document.getElementById("gameContainer").innerHTML=`
<div style="padding:40px; text-align:center">
<h1 style="color:#16c784">üèÜ Case Closed!</h1>
<p>You solved ${gameState.solved.size}/${rooms.length} rooms.</p>

<div class="final-riddle">
<h3>üß© Bonus Riddle</h3>
<p style="font-style:italic">
No wires in sight, yet minds are linked,<br>
A room where signals are tested and synced.<br>
<strong>Name this place.</strong>
</p>

<input id="riddleInput" placeholder="Enter answer..." />
<button onclick="checkRiddle()">Submit</button>
<div id="riddleMsg"></div>
</div>

<div class="play-again" onclick="restartGame()">üîÑ Play Again</div>
</div>
`;
}

function checkRiddle(){
const v=document.getElementById("riddleInput").value.trim().toLowerCase();
const m=document.getElementById("riddleMsg");
const accepted=["internet lab","the internet lab","internetlab","internet-lab"];
if(accepted.includes(v)){
m.className="message success";
m.textContent="‚úÖ Correct! This is the Internet Lab.";
const sound = document.getElementById("successSound");
if(sound){sound.currentTime=0; sound.play().catch(()=>{});}
document.getElementById("riddleInput").disabled=true;
}else{
m.className="message error";
m.textContent="‚ùå Not quite. Try again.";
}
}

/* ================= SIDEBAR ================= */
function updateSidebar(){
document.getElementById("hintsUsed").textContent=gameState.hintsUsed;
document.getElementById("progressText").textContent=
`${Math.round(gameState.solved.size/rooms.length*100)}% Complete`;
document.getElementById("evidenceList").innerHTML=
rooms.map(r=>`
<div class="evidence-item">
${gameState.evidence.has(r.evidence)?"‚úÖ":"üîí"} ${r.evidence}
</div>`).join("");
}

/* ================= RESTART ================= */
function restartGame(){
gameState.currentRoom=0;
gameState.solved.clear();
gameState.evidence.clear();
gameState.hintsUsed=0;
gameState.roomFlags={};
loadRoom(0);
}

/* ================= START ================= */
loadRoom(0);
</script>

</body>
</html>

