<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Unsolved Case</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
  background:linear-gradient(135deg,#1a1a2e,#16213e);
  color:#e0e0e0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px
}
.container{
  max-width:1100px;
  width:100%;
  background:#0f3460;
  border-radius:12px;
  display:grid;
  grid-template-columns:1fr 300px;
  overflow:hidden
}
.main-content{padding:30px}
.sidebar{
  background:#0a1e35;
  padding:20px;
  border-left:2px solid #e94560
}
h1{color:#e94560}
.room-title{color:#16c784;margin:10px 0}
.visual-clues{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:15px;
  margin-top:15px
}
.clue-image{
  background:rgba(255,255,255,.1);
  border:2px solid #16c784;
  border-radius:8px;
  height:180px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:.2s;
  position:relative;
  overflow:hidden;
}
.clue-image:hover{border-color:#e94560;transform:scale(1.05)}
.clue-hidden{
  display:none;
  font-size:14px;
  margin-top:6px;
  color:#16c784;
}
.uv-button{
  position:absolute;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  padding:5px 8px;
  background:#16c784;
  color:#0f3460;
  border:none;
  border-radius:5px;
  cursor:pointer;
  font-size:12px;
}
.timer{
  border:2px solid #e94560;
  padding:12px;
  border-radius:8px;
  text-align:center;
  font-family:monospace;
  font-size:22px;
  margin-bottom:15px
}
input{
  padding:10px;
  border-radius:6px;
  border:2px solid #16c784;
  background:transparent;
  color:#fff;
  width:100%;
  margin-top:10px
}
button{
  padding:10px 16px;
  background:#e94560;
  border:none;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
  margin-top:12px
}
.message.success{color:#16c784;margin-top:12px}
.message.error{color:#e94560;margin-top:12px}
.image-modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  align-items:center;
  justify-content:center;
  z-index:100
}
.image-modal.active{display:flex}
.modal-content{
  background:#0f3460;
  padding:30px;
  border-radius:10px;
  text-align:center;
  max-width:520px;
  position:relative
}
.modal-close{
  position:absolute;
  top:10px;
  right:10px;
  background:#e94560;
  border:none;
  color:#fff;
  padding:5px 10px;
  border-radius:6px;
  cursor:pointer
}
.evidence-item{margin-bottom:6px;font-size:14px}
.hint-button{
  background:#16213e;
  color:#16c784;
}
.play-again{margin-top:20px;cursor:pointer;font-size:28px;color:#16c784}
.uv-active{
  background: #ffff99 !important;
  color: #000 !important;
}
</style>
</head>

<body>

<div class="container" id="gameContainer"></div>

<div class="image-modal" id="imageModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeImageModal()">X</button>
    <div id="modalImage" style="font-size:120px"></div>
    <div id="modalDescription" style="margin-top:10px"></div>
  </div>
</div>

<script>
const gameState={
  currentRoom:0,
  hintsUsed:0,
  evidence:new Set(),
  timeRemaining:0,
  timer:null,
  uvUsed:false
};

const rooms=[
{
  title:"Room 1: The Crime Scene",
  timeLimit:300,
  story:"A diamond vanished. Investigate visual clues.",
  visualClues:[{emoji:"ğŸ“",label:"Note Found",description:"Meet at 1_:3_", hidden:"Secret hint revealed by UV lamp: The time is 15:30"},
               {emoji:"ğŸ•",label:"Clock",description:"Clock shows 3:30 PM"},
               {emoji:"ğŸ”’",label:"Safe Lock",description:"4-digit safe opened during gap"},
               {emoji:"ğŸ“Š",label:"Security Log",description:"Security log is empty"}],
  puzzle:{question:"What time was the diamond stolen? (HH:MM)",answer:"15:30"},
  evidence:"Security Log Extract",
  hint:"Check the clock and the note carefully ğŸ•ğŸ“ â€” remember to use 24-hour format"
},
{
  title:"Room 2: Suspect Interrogation",
  timeLimit:180,
  story:"Study suspects and alibis.",
  visualClues:[{emoji:"ğŸ‘¨",label:"Alex",description:"Left shop at 3:15"},
               {emoji:"ğŸ‘®",label:"Ben",description:"Watch time mismatched"},
               {emoji:"ğŸ‘©",label:"Clara",description:"Call forwarded at 3:15"},
               {emoji:"ğŸ“¹",label:"Camera",description:"Blurred figure in guard jacket"}],
  puzzle:{question:"Who is lying? (Alex, Ben, Clara)",answer:"clara"},
  evidence:"Phone Records",
  hint:"Compare their alibis carefully"
},
{
  title:"Room 3: The Final Code",
  timeLimit:120,
  story:"Combine everything to unlock the vault.",
  visualClues:[{emoji:"ğŸ›",label:"Digit 1",description:"One pillar"},
               {emoji:"â­",label:"Digit 5",description:"Five-point star"},
               {emoji:"ğŸ”º",label:"Digit 3",description:"Three barriers"},
               {emoji:"ğŸ”",label:"Digit 0",description:"Round lock"}],
  puzzle:{question:"Enter the 4-digit code",answer:"1530"},
  evidence:"Confession Evidence",
  hint:"Use the digits you found in previous rooms"
}
];

function formatTime(s){const m=Math.floor(s/60);const sec=s%60;return `${m}:${sec<10?"0":""}${sec}`;}

function showInstructions(){
  document.getElementById("gameContainer").innerHTML=`
    <div class="main-content" style="grid-column:1/-1;text-align:center">
      <h1>ğŸ•µ How to Play</h1>
      <p>Solve all rooms to uncover the final hidden clue.</p>
      <button onclick="startGame()">ğŸš¨ Start Investigation</button>
    </div>
  `;
}

function startGame(){gameState.currentRoom=0;gameState.evidence.clear();gameState.uvUsed=false;loadRoom(0);}

function loadRoom(i){
  if(i>=rooms.length){showFinalRiddle();return;}
  gameState.currentRoom=i;
  gameState.timeRemaining=rooms[i].timeLimit;

  document.getElementById("gameContainer").innerHTML=`
    <div class="main-content">
      <h1>ğŸ” The Unsolved Case</h1>
      <div class="room-title">${rooms[i].title}</div>
      <div class="timer" id="timerDisplay"></div>
      <p>${rooms[i].story}</p>
      <div class="visual-clues">
        ${rooms[i].visualClues.map((c,idx)=>`
          <div class="clue-image" id="clue-${idx}">
            <div style="font-size:60px">${c.emoji}</div>
            <div>${c.label}</div>
            ${i===0 && idx===0 && !gameState.uvUsed?`<button class="uv-button" onclick="activateUV()">UV Lamp</button>`:''}
            <div class="clue-hidden" id="hidden-${idx}">${c.hidden || ''}</div>
          </div>`).join("")}
      </div>
      <p style="margin-top:20px">${rooms[i].puzzle.question}</p>
      <input id="answerInput">
      <button id="submitBtn" onclick="submitAnswer()">Submit</button>
      <button class="hint-button" onclick="showHint()">ğŸ’¡ Hint</button>
      <div id="hintMsg"></div>
      <div id="message"></div>
    </div>
    <div class="sidebar">
      <h3>Evidence</h3>
      ${rooms.map(r=>`
        <div class="evidence-item">${gameState.evidence.has(r.evidence)?"âœ…":"ğŸ”’"} ${r.evidence}</div>
      `).join("")}
    </div>
  `;
  startTimer();
}

function activateUV(){
  if(gameState.uvUsed) return;
  gameState.uvUsed=true;
  const hidden=document.getElementById("hidden-0");
  hidden.style.display='block';
  alert("UV Lamp activated! Hidden clue revealed for 1 minute.");
  setTimeout(()=>{
    hidden.style.display='none';
    alert("UV Lamp effect ended.");
  },60000); // 1 minute
}

function startTimer(){
  clearInterval(gameState.timer);
  gameState.timer=setInterval(()=>{
    gameState.timeRemaining--;
    document.getElementById("timerDisplay").textContent=
      `â± ${formatTime(Math.max(gameState.timeRemaining,0))}`;
    if(gameState.timeRemaining<=0){clearInterval(gameState.timer);showInstructions();}
  },1000);
}

function submitAnswer(){
  const input=document.getElementById("answerInput");
  const btn=document.getElementById("submitBtn");
  const v=input.value.trim().toLowerCase();
  const r=rooms[gameState.currentRoom];
  const m=document.getElementById("message");

  if(v===r.puzzle.answer){
    gameState.evidence.add(r.evidence);
    clearInterval(gameState.timer);
    m.className="message success";
    m.innerHTML=`Correct!<br><button onclick="loadRoom(${gameState.currentRoom+1})">â¡ Next</button>`;
  } else {
    m.className="message error";
    let waitTime=30;
    input.disabled=true;
    btn.disabled=true;

    const countdown=setInterval(()=>{
      btn.textContent=`Try again in ${waitTime}s`;
      waitTime--;
      if(waitTime<0){
        clearInterval(countdown);
        input.disabled=false;
        btn.disabled=false;
        btn.textContent="Submit";
        m.textContent="";
      }
    },1000);

    gameState.timeRemaining=Math.max(gameState.timeRemaining-30,0);
  }
}

function showHint(){
  document.getElementById("hintMsg").textContent=rooms[gameState.currentRoom].hint;
  gameState.timeRemaining=Math.max(gameState.timeRemaining-60,0);
}

function openImageModal(idx){
  const clue=rooms[gameState.currentRoom].visualClues[idx];
  document.getElementById("modalImage").textContent=clue.emoji;
  document.getElementById("modalDescription").textContent=clue.description;
  document.getElementById("imageModal").classList.add("active");
}

function closeImageModal(){document.getElementById("imageModal").classList.remove("active");}

/* ğŸ” FINAL RIDDLE */
function showFinalRiddle(){
  document.getElementById("gameContainer").innerHTML=`
    <div class="main-content" style="grid-column:1/-1;text-align:center">
      <h1>ğŸŒŸ Final Clue</h1>
      <p style="margin:20px 0;font-style:italic">
        No wires in sight, yet minds are linked,<br>
        A room where signals are tested and synced.<br>
        <strong>What is this place?</strong>
      </p>
      <input id="riddleAnswer" placeholder="Your answer">
      <button onclick="checkRiddle()">Submit Answer</button>
      <div id="riddleMsg"></div>
    </div>
  `;
}

function checkRiddle(){
  const a=document.getElementById("riddleAnswer").value.trim().toLowerCase();
  const m=document.getElementById("riddleMsg");
  const valid=["internet lab"];

  if(valid.includes(a)){
    m.className="message success";
    m.innerHTML="âœ… Correct!<br><button onclick='showFinalPage()'>ğŸ† Finish</button>";
  }else{
    m.className="message error";
    m.textContent="âŒ Incorrect. Think about testing signals without wires.";
  }
}

function showFinalPage(){
  document.getElementById("gameContainer").innerHTML=`
    <div class="main-content" style="grid-column:1/-1;text-align:center">
      <h1 style="color:#16c784">ğŸ† Case Closed!</h1>
      <p>Congratulations! You solved all rooms and uncovered the final clue.</p>
      <div class="play-again" onclick="showInstructions()">ğŸ”„ Play Again</div>
    </div>
  `;
}

showInstructions();
</script>

</body>
</html>
