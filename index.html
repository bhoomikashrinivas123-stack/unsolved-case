<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Unsolved Case</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#1a1a2e,#16213e);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container{
  width:1000px;
  background:#0f3460;
  border-radius:12px;
  display:grid;
  grid-template-columns:1fr 280px;
  overflow:hidden;
}
.main{padding:25px}
.sidebar{
  background:#0a1e35;
  padding:20px;
  border-left:2px solid #e94560;
}
h1{color:#e94560}
.timer{
  border:2px solid #e94560;
  padding:10px;
  border-radius:6px;
  font-family:monospace;
  text-align:center;
}
.visuals{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:15px;
  margin-top:15px;
}
.clue{
  background:rgba(255,255,255,.1);
  border:2px solid #16c784;
  border-radius:8px;
  height:160px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}
button{
  padding:10px 15px;
  background:#e94560;
  border:none;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
  margin-top:10px;
}
.hint-btn{background:#16c784;color:#000}
.success{color:#16c784}
.error{color:#e94560}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  justify-content:center;
  align-items:center;
}
.modal.active{display:flex}
.modal-box{
  background:#0f3460;
  padding:30px;
  border-radius:10px;
  text-align:center;
  width:420px;
}
.play-again{
  font-size:32px;
  cursor:pointer;
  margin-top:20px;
}
</style>
</head>

<body>

<div class="container" id="game">
  <div class="main">
    <h1>üîç The Unsolved Case</h1>
    <h3 id="roomTitle"></h3>
    <div class="timer" id="timer"></div>
    <div id="content"></div>
  </div>
  <div class="sidebar">
    <p>Room: <span id="roomNum"></span></p>
    <p>Hints used: <span id="hintsUsed">0</span></p>
    <p id="progress">0% Complete</p>
    <h3>Evidence</h3>
    <div id="evidence"></div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <button onclick="closeModal()">X</button>
    <div id="modalEmoji" style="font-size:90px"></div>
    <div id="modalText"></div>
    <div id="modalActions"></div>
  </div>
</div>

<script>
/* ---------------- STATE ---------------- */
const state={
  room:0,
  time:0,
  timer:null,
  hints:0,
  solved:new Set(),
  evidence:new Set(),
  uv:{time:120,active:false,revealed:false}
};

/* ---------------- ROOMS ---------------- */
const rooms=[
{
 title:"Room 1: Crime Scene",
 time:300,
 hint:"Look carefully at the note and the clock.",
 clues:[
  {emoji:"üìù",label:"Note Found",text:"Meet at 1_:3_"},
  {emoji:"üïê",label:"Clock",text:"Clock shows 3:30 PM"},
  {emoji:"üîí",label:"Safe",text:"Opened during a short gap"},
  {emoji:"üìä",label:"Security Log",text:"Suspicious vault activity"}
 ],
 question:"What time was the diamond stolen?",
 answer:"15:30",
 evidence:"Security Log"
},
{
 title:"Room 2: Interrogation",
 time:180,
 hint:"Who benefits from incorrect timing?",
 clues:[
  {emoji:"üë®",label:"Alex",text:"Left at 3:15"},
  {emoji:"üëÆ",label:"Ben",text:"Watch incorrect"},
  {emoji:"üë©",label:"Clara",text:"Call forwarded"},
  {emoji:"üìπ",label:"Camera",text:"Guard jacket"}
 ],
 question:"Who is lying?",
 answer:"clara",
 evidence:"Phone Records"
},
{
 title:"Room 3: Final Code",
 time:120,
 hint:"Use the digits you discovered earlier.",
 clues:[
  {emoji:"üèõ",label:"1",text:"One pillar"},
  {emoji:"‚≠ê",label:"5",text:"Five points"},
  {emoji:"üî∫",label:"3",text:"Three barriers"},
  {emoji:"üîê",label:"0",text:"Round lock"}
 ],
 question:"Enter the 4-digit code",
 answer:"1530",
 evidence:"Confession"
}
];

/* ---------------- GAME FLOW ---------------- */
function loadRoom(i){
 if(i>=rooms.length){showFinal();return;}
 state.room=i;
 state.time=rooms[i].time;
 document.getElementById("roomTitle").textContent=rooms[i].title;
 document.getElementById("roomNum").textContent=`${i+1}/3`;

 document.getElementById("content").innerHTML=`
 <p>${rooms[i].question}</p>
 <div class="visuals">
 ${rooms[i].clues.map((c,idx)=>`
  <div class="clue" onclick="openClue(${idx})">
   <div style="font-size:50px">${c.emoji}</div>${c.label}
  </div>`).join("")}
 </div>

 <input id="answer">
 <button onclick="submit()">Submit</button>
 <button class="hint-btn" onclick="hint()">üí° Hint</button>
 <div id="hintText"></div>
 <div id="msg"></div>
 `;
 startTimer();
 updateSidebar();
}

function startTimer(){
 clearInterval(state.timer);
 state.timer=setInterval(()=>{
  state.time--;
  document.getElementById("timer").textContent=
   `‚è± ${Math.floor(state.time/60)}:${(state.time%60).toString().padStart(2,"0")}`;
  if(state.time<=0) loadRoom(state.room+1);
 },1000);
}

function submit(){
 const v=document.getElementById("answer").value.trim().toLowerCase();
 if(v===rooms[state.room].answer){
  document.getElementById("msg").className="success";
  document.getElementById("msg").textContent="Correct!";
  state.solved.add(state.room);
  state.evidence.add(rooms[state.room].evidence);
  setTimeout(()=>loadRoom(state.room+1),800);
 }else{
  document.getElementById("msg").className="error";
  document.getElementById("msg").textContent="Incorrect. Try again.";
 }
 updateSidebar();
}

function hint(){
 document.getElementById("hintText").textContent=rooms[state.room].hint;
 state.hints++;
 state.time=Math.max(0,state.time-60);
 updateSidebar();
}

/* ---------------- UV (ROOM 1 ONLY) ---------------- */
function openClue(idx){
 const clue=rooms[state.room].clues[idx];
 document.getElementById("modalEmoji").textContent=clue.emoji;
 document.getElementById("modalActions").innerHTML="";
 if(state.room===0 && idx===0){
  if(state.uv.revealed){
   document.getElementById("modalText").innerHTML="<b>Revealed:</b> Meet at 15:30";
  }else{
   document.getElementById("modalText").innerHTML=
    `${clue.text}<br>UV warming: ${state.uv.time}s`;
   const b=document.createElement("button");
   b.textContent="Use UV Lamp";
   b.onclick=startUV;
   document.getElementById("modalActions").appendChild(b);
  }
 }else{
  document.getElementById("modalText").textContent=clue.text;
 }
 document.getElementById("modal").classList.add("active");
}

function startUV(){
 if(state.uv.active) return;
 state.uv.active=true;
 const uv=setInterval(()=>{
  state.uv.time--;
  document.getElementById("modalText").innerHTML=
   `Meet at 1_:3_<br>UV warming: ${state.uv.time}s`;
  if(state.uv.time<=0){
   clearInterval(uv);
   state.uv.revealed=true;
   document.getElementById("modalText").innerHTML="<b>Revealed:</b> Meet at 15:30";
  }
 },1000);
}

function closeModal(){
 document.getElementById("modal").classList.remove("active");
}

/* ---------------- FINAL ---------------- */
function showFinal(){
 document.getElementById("game").innerHTML=`
 <div style="padding:40px;text-align:center">
  <h1>üèÜ Case Closed</h1>
  <p>No wires in sight, yet minds are linked.<br>
  A room where signals are tested and synced.</p>
  <input id="riddle">
  <button onclick="check()">Submit</button>
  <div id="riddleMsg"></div>
  <div class="play-again" onclick="location.reload()">üîÑ</div>
 </div>`;
}

function check(){
 const a=document.getElementById("riddle").value.toLowerCase();
 document.getElementById("riddleMsg").textContent=
  a.includes("internet")?"Correct!":"Try again.";
}

function updateSidebar(){
 document.getElementById("hintsUsed").textContent=state.hints;
 document.getElementById("progress").textContent=
  `${Math.round(state.solved.size/3*100)}% Complete`;
 document.getElementById("evidence").innerHTML=
  rooms.map(r=>state.evidence.has(r.evidence)?"‚úÖ "+r.evidence:"üîí "+r.evidence).join("<br>");
}

loadRoom(0);
</script>

</body>
</html>
