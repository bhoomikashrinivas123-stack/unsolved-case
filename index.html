<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Unsolved Case</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Tahoma,sans-serif;
  background:linear-gradient(135deg,#1a1a2e,#16213e);
  color:#e0e0e0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px
}
.container{
  max-width:1100px;
  width:100%;
  background:#0f3460;
  border-radius:12px;
  display:grid;
  grid-template-columns:1fr 300px;
  overflow:hidden
}
.main-content{padding:30px}
.sidebar{
  background:#0a1e35;
  padding:20px;
  border-left:2px solid #e94560
}
h1{color:#e94560}
.room-title{color:#16c784;margin:10px 0}
.timer{
  border:2px solid #e94560;
  padding:12px;
  border-radius:8px;
  font-family:monospace;
  text-align:center;
  margin-bottom:15px
}
.visual-clues{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:15px
}
.clue-image{
  height:180px;
  background:rgba(255,255,255,.1);
  border:2px solid #16c784;
  border-radius:8px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.clue-image:hover{border-color:#e94560}
button{
  padding:10px 16px;
  background:#e94560;
  border:none;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
  margin-top:10px
}
.hint-btn{background:#16c784;color:#000}
.message.success{color:#16c784}
.message.error{color:#e94560}

.image-modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  justify-content:center;
  align-items:center
}
.image-modal.active{display:flex}
.modal-content{
  background:#0f3460;
  padding:30px;
  border-radius:10px;
  max-width:500px;
  text-align:center
}

.final-riddle{
  border:2px solid #16c784;
  padding:20px;
  margin-top:20px
}
.play-again{font-size:30px;margin-top:20px;cursor:pointer}
</style>
</head>

<body>

<div class="container" id="gameContainer">
  <div class="main-content">
    <h1>üîç The Unsolved Case</h1>
    <div class="room-title" id="roomTitle"></div>
    <div class="timer" id="timerDisplay"></div>
    <div id="roomContent"></div>
  </div>

  <div class="sidebar">
    <p><strong>Room:</strong> <span id="roomNumber"></span></p>
    <p><strong>Hints used:</strong> <span id="hintsUsed">0</span></p>
    <p id="progressText">0% Complete</p>
    <h3>Evidence</h3>
    <div id="evidenceList"></div>
  </div>
</div>

<div class="image-modal" id="imageModal">
  <div class="modal-content">
    <button onclick="closeImageModal()">X</button>
    <div id="modalImage" style="font-size:120px"></div>
    <div id="modalDescription"></div>
    <div id="modalActions"></div>
  </div>
</div>

<audio id="successSound">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3">
</audio>

<audio id="errorSound">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3">
</audio>

<script>
const gameState={
  currentRoom:0,
  hintsUsed:0,
  solved:new Set(),
  evidence:new Set(),
  timeRemaining:0,
  timer:null,
  roomFlags:{},
  cooldown:false
};

const rooms=[
{
 title:"Room 1: The Crime Scene",
 timeLimit:300,
 story:"A diamond vanished. Investigate visual clues.",
 visualClues:[
  {emoji:"üìù",label:"Note Found",description:"Meet at 1_:3_"},
  {emoji:"üïê",label:"Clock",description:"Clock shows 3:30 PM"},
  {emoji:"üîí",label:"Safe Lock",description:"Opened during time gap"},
  {emoji:"üìä",label:"Security Log",description:"Suspicious activity near vault"}
 ],
 puzzle:{question:"What time was the diamond stolen?",answer:"15:30"},
 evidence:"Security Log",
 hint:"Compare the note with the clock"
},
{
 title:"Room 2: Suspect Interrogation",
 timeLimit:180,
 story:"One suspect is lying.",
 visualClues:[
  {emoji:"üë®",label:"Alex",description:"Left at 3:15"},
  {emoji:"üëÆ",label:"Ben",description:"Watch mismatched"},
  {emoji:"üë©",label:"Clara",description:"Call forwarded"},
  {emoji:"üìπ",label:"Camera",description:"Blurred guard jacket"}
 ],
 puzzle:{question:"Who is lying?",answer:"clara"},
 evidence:"Phone Records",
 hint:"Look at time inconsistencies"
},
{
 title:"Room 3: Final Code",
 timeLimit:120,
 story:"Unlock the vault.",
 visualClues:[
  {emoji:"üèõ",label:"1",description:"One pillar"},
  {emoji:"‚≠ê",label:"5",description:"Five points"},
  {emoji:"üî∫",label:"3",description:"Three barriers"},
  {emoji:"üîê",label:"0",description:"Round lock"}
 ],
 puzzle:{question:"Enter the 4-digit code",answer:"1530"},
 evidence:"Confession",
 hint:"Use digits from earlier"
}
];

function loadRoom(i){
 if(i>=rooms.length){showFinal();return;}
 gameState.currentRoom=i;
 gameState.timeRemaining=rooms[i].timeLimit;
 if(!gameState.roomFlags[i]){
   gameState.roomFlags[i]={uvTime:120,uvRunning:false,revealed:false};
 }
 document.getElementById("roomTitle").textContent=rooms[i].title;
 document.getElementById("roomNumber").textContent=`${i+1}/3`;

 document.getElementById("roomContent").innerHTML=`
 <p>${rooms[i].story}</p>
 <div class="visual-clues">
 ${rooms[i].visualClues.map((c,idx)=>`
 <div class="clue-image" onclick="openImageModal(${idx})">
 <div style="font-size:60px">${c.emoji}</div>${c.label}
 </div>`).join("")}
 </div>

 <p>${rooms[i].puzzle.question}</p>
 <input id="answerInput">
 <button onclick="submitAnswer()">Submit</button>
 <button class="hint-btn" onclick="showHint()">üí° Hint</button>
 <div id="hintMsg"></div>
 <div id="message"></div>
 `;
 startTimer();
 updateSidebar();
}

function startTimer(){
 clearInterval(gameState.timer);
 gameState.timer=setInterval(()=>{
  gameState.timeRemaining--;
  document.getElementById("timerDisplay").textContent=`‚è± ${Math.floor(gameState.timeRemaining/60)}:${(gameState.timeRemaining%60).toString().padStart(2,"0")}`;
  if(gameState.timeRemaining<=0) loadRoom(gameState.currentRoom+1);
 },1000);
}

function submitAnswer(){
 if(gameState.cooldown) return;
 const v=document.getElementById("answerInput").value.trim().toLowerCase();
 const r=rooms[gameState.currentRoom];
 const m=document.getElementById("message");

 if(v===r.puzzle.answer){
  document.getElementById("successSound").play();
  gameState.solved.add(gameState.currentRoom);
  gameState.evidence.add(r.evidence);
  m.className="message success";
  m.textContent="Correct!";
  setTimeout(()=>loadRoom(gameState.currentRoom+1),1000);
 }else{
  document.getElementById("errorSound").play();
  gameState.cooldown=true;
  let t=30;
  const cd=setInterval(()=>{
   m.className="message error";
   m.textContent=`Try again in ${t--}s`;
   if(t<0){
    clearInterval(cd);
    gameState.cooldown=false;
    m.textContent="You can try again.";
   }
  },1000);
 }
}

function openImageModal(idx){
 const r=rooms[gameState.currentRoom];
 const flags=gameState.roomFlags[gameState.currentRoom];
 const clue=r.visualClues[idx];
 document.getElementById("modalImage").textContent=clue.emoji;

 if(gameState.currentRoom===0 && clue.label==="Note Found"){
  if(flags.revealed){
   document.getElementById("modalDescription").innerHTML="<b>Revealed:</b> Meet at 15:30";
  }else{
   document.getElementById("modalDescription").innerHTML=`${clue.description}<br>UV: ${flags.uvTime}s`;
   document.getElementById("modalActions").innerHTML=`<button onclick="startUV()">Use UV Lamp</button>`;
  }
 }else{
  document.getElementById("modalDescription").textContent=clue.description;
  document.getElementById("modalActions").innerHTML="";
 }
 document.getElementById("imageModal").classList.add("active");
}

function startUV(){
 const flags=gameState.roomFlags[0];
 if(flags.uvRunning) return;
 flags.uvRunning=true;
 const uv=setInterval(()=>{
  flags.uvTime--;
  document.getElementById("modalDescription").innerHTML=`Meet at 1_:3_<br>UV: ${flags.uvTime}s`;
  if(flags.uvTime<=0){
   clearInterval(uv);
   flags.revealed=true;
   document.getElementById("modalDescription").innerHTML="<b>Revealed:</b> Meet at 15:30";
  }
 },1000);
}

function closeImageModal(){
 document.getElementById("imageModal").classList.remove("active");
}

function showHint(){
 document.getElementById("hintMsg").textContent=rooms[gameState.currentRoom].hint;
 gameState.hintsUsed++;
 gameState.timeRemaining=Math.max(0,gameState.timeRemaining-60);
 updateSidebar();
}

function showFinal(){
 document.getElementById("gameContainer").innerHTML=`
 <div style="padding:40px;text-align:center">
 <h1>üèÜ Case Closed</h1>
 <div class="final-riddle">
 No wires in sight, yet minds are linked‚Ä¶<br>
 <b>Name this place</b>
 <input id="riddle">
 <button onclick="checkRiddle()">Submit</button>
 <div id="riddleMsg"></div>
 </div>
 <div class="play-again" onclick="location.reload()">üîÑ</div>
 </div>`;
}

function checkRiddle(){
 const a=document.getElementById("riddle").value.toLowerCase();
 if(a.includes("internet")){
  document.getElementById("riddleMsg").textContent="Correct!";
  document.getElementById("successSound").play();
 }else{
  document.getElementById("riddleMsg").textContent="Try again.";
 }
}

function updateSidebar(){
 document.getElementById("hintsUsed").textContent=gameState.hintsUsed;
 document.getElementById("progressText").textContent=`${Math.round(gameState.solved.size/3*100)}%`;
 document.getElementById("evidenceList").innerHTML=
 rooms.map(r=>`${gameState.evidence.has(r.evidence)?"‚úÖ":"üîí"} ${r.evidence}`).join("<br>");
}

loadRoom(0);
</script>

</body>
</html>
