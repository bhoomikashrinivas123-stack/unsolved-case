<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Unsolved Case</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
  background:linear-gradient(135deg,#1a1a2e,#16213e);
  color:#e0e0e0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px
}
.container{
  max-width:1100px;width:100%;
  background:#0f3460;border-radius:12px;
  display:grid;grid-template-columns:1fr 300px;
  overflow:hidden
}
.main-content{padding:30px}
.sidebar{
  background:#0a1e35;padding:20px;
  border-left:2px solid #e94560
}
h1{color:#e94560}
.room-title{color:#16c784;margin:10px 0}
.visual-clues{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:15px;margin-top:15px
}
.clue-image{
  background:rgba(255,255,255,.1);
  border:2px solid #16c784;
  border-radius:8px;height:180px;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  cursor:pointer;transition:.2s
}
.clue-image:hover{border-color:#e94560;transform:scale(1.05)}
.timer{
  border:2px solid #e94560;padding:12px;
  border-radius:8px;text-align:center;
  font-family:monospace;font-size:22px;margin-bottom:15px
}
input{
  padding:10px;border-radius:6px;
  border:2px solid #16c784;
  background:transparent;color:#fff;width:100%
}
button{
  padding:10px 16px;background:#e94560;
  border:none;color:#fff;border-radius:6px;
  cursor:pointer;margin-top:10px
}
.message.success{color:#16c784;margin-top:10px}
.message.error{color:#e94560;margin-top:10px}
.image-modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.9);
  align-items:center;justify-content:center
}
.image-modal.active{display:flex}
.modal-content{
  background:#0f3460;padding:30px;
  border-radius:10px;text-align:center;
  max-width:520px;position:relative
}
.modal-close{
  position:absolute;top:10px;right:10px;
  background:#e94560;border:none;color:#fff;
  padding:5px 10px;border-radius:6px;cursor:pointer
}
.evidence-item{margin-bottom:6px;font-size:14px}
.hint-button{
  display:flex;align-items:center;margin-top:10px;
  cursor:pointer;color:#16c784;
  background:#16213e;border:none;padding:8px;border-radius:6px
}
.hint-message{margin-top:6px;font-size:14px;font-style:italic}
.play-again{margin-top:20px;font-size:30px;color:#16c784;cursor:pointer}
</style>
</head>

<body>

<div class="container" id="gameContainer">
  <div class="main-content">
    <h1>üîç The Unsolved Case</h1>
    <div class="room-title" id="roomTitle"></div>
    <div class="timer" id="timerDisplay"></div>
    <div id="roomContent"></div>
  </div>

  <div class="sidebar">
    <p><strong>Room:</strong> <span id="roomNumber"></span></p>
    <p><strong>Hints used:</strong> <span id="hintsUsed">0</span></p>
    <p id="progressText">0% Complete</p>
    <h3 style="margin-top:15px">Evidence</h3>
    <div id="evidenceList"></div>
  </div>
</div>

<div class="image-modal" id="imageModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeImageModal()">X</button>
    <div id="modalImage" style="font-size:120px"></div>
    <div id="modalDescription" style="margin-top:10px"></div>
    <div id="modalActions"></div>
  </div>
</div>

<audio id="successSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3">
</audio>

<script>
const gameState={
  currentRoom:0,
  hintsUsed:0,
  solved:new Set(),
  evidence:new Set(),
  timeRemaining:0,
  timer:null,
  roomFlags:{}
};

const rooms=[
{
  title:"Room 1: The Crime Scene",
  timeLimit:300,
  story:"A diamond vanished. Investigate visual clues.",
  visualClues:[
    {emoji:"üìù",label:"Note Found",description:"Meet at 1_:3_"},
    {emoji:"üïê",label:"Clock",description:"Clock shows 3:30 PM"},
    {emoji:"üîí",label:"Safe Lock",description:"4-digit safe opened during gap"},
    {emoji:"üìä",label:"Security Log",description:"Security log is empty"}
  ],
  puzzle:{question:"What time was the diamond stolen? (HH:MM)",answer:"15:30"},
  evidence:"Security Log Extract",
  hint:"Check the clock and the note üïêüìù"
},
{
  title:"Room 2: Suspect Interrogation",
  timeLimit:180,
  story:"Study suspects and alibis.",
  visualClues:[
    {emoji:"üë®",label:"Alex",description:"Left shop at 3:15"},
    {emoji:"üëÆ",label:"Ben",description:"Watch time mismatched"},
    {emoji:"üë©",label:"Clara",description:"Call forwarded at 3:15"},
    {emoji:"üìπ",label:"Camera",description:"Blurred figure in guard jacket"}
  ],
  puzzle:{question:"Who is lying? (Alex, Ben, Clara)",answer:"clara"},
  evidence:"Phone Records",
  hint:"Compare their alibis carefully"
},
{
  title:"Room 3: The Final Code",
  timeLimit:120,
  story:"Combine everything to unlock the vault.",
  visualClues:[
    {emoji:"üèõ",label:"Digit 1",description:"One pillar"},
    {emoji:"‚≠ê",label:"Digit 5",description:"Five-point star"},
    {emoji:"üî∫",label:"Digit 3",description:"Three barriers"},
    {emoji:"üîê",label:"Digit 0",description:"Round lock"}
  ],
  puzzle:{question:"Enter the 4-digit code",answer:"1530"},
  evidence:"Confession Evidence",
  hint:"Use the digits you found earlier"
}
];

function formatTime(s){
  const m=Math.floor(s/60),sec=s%60;
  return `${m}:${sec<10?"0":""}${sec}`;
}

function loadRoom(i){
  if(i>=rooms.length){showFinalScreen();return;}

  if(!gameState.roomFlags[i]){
    gameState.roomFlags[i]={
      noteUV:{active:false,cooldown:0,revealed:false,interval:null}
    };
  }

  gameState.currentRoom=i;
  gameState.timeRemaining=rooms[i].timeLimit;

  document.getElementById("roomTitle").textContent=rooms[i].title;
  document.getElementById("roomNumber").textContent=`${i+1}/${rooms.length}`;

  document.getElementById("roomContent").innerHTML=`
    <p>${rooms[i].story}</p>
    <div class="visual-clues">
      ${rooms[i].visualClues.map((c,idx)=>`
        <div class="clue-image" onclick="openImageModal(${idx})">
          <div style="font-size:60px">${c.emoji}</div>
          <div>${c.label}</div>
        </div>`).join("")}
    </div>
    <div style="margin-top:20px">
      <p>${rooms[i].puzzle.question}</p>
      <input id="answerInput"/>
      <button onclick="submitAnswer()">Submit</button>
      <button class="hint-button" onclick="showHint()">üí° Hint</button>
      <div id="hintMsg" class="hint-message"></div>
      <div id="message" class="message"></div>
    </div>
  `;

  startTimer();
  updateSidebar();
}

function startTimer(){
  clearInterval(gameState.timer);
  gameState.timer=setInterval(()=>{
    if(gameState.timeRemaining>0)gameState.timeRemaining--;
    document.getElementById("timerDisplay").textContent=
      `‚è± ${formatTime(gameState.timeRemaining)}`;
  },1000);
}

function submitAnswer(){
  const v=document.getElementById("answerInput").value.trim().toLowerCase();
  const r=rooms[gameState.currentRoom];
  const m=document.getElementById("message");

  if(v===r.puzzle.answer){
    m.className="message success";
    m.textContent="Correct!";
    gameState.solved.add(gameState.currentRoom);
    gameState.evidence.add(r.evidence);
    updateSidebar();

    const btn=document.createElement("button");
    btn.textContent="‚û° Next Room";
    btn.onclick=()=>loadRoom(gameState.currentRoom+1);
    m.appendChild(document.createElement("br"));
    m.appendChild(btn);
  }else{
    m.className="message error";
    m.textContent="Incorrect! Try again in 30s";
    document.getElementById("answerInput").disabled=true;
    setTimeout(()=>{
      document.getElementById("answerInput").disabled=false;
      m.textContent="";
    },30000);
    gameState.timeRemaining+=30;
  }
}

function openImageModal(idx){
  const roomIndex=gameState.currentRoom;
  const clue=rooms[roomIndex].visualClues[idx];
  const noteUV=gameState.roomFlags[roomIndex].noteUV;

  document.getElementById("modalImage").textContent=clue.emoji;
  const desc=document.getElementById("modalDescription");
  const actions=document.getElementById("modalActions");
  actions.innerHTML="";

  // üîí UV STRICTLY LIMITED
  if(roomIndex===0 && idx===0){
    if(noteUV.revealed){
      desc.innerHTML="<strong>Revealed note:</strong> Meet at 15:30";
    }else if(noteUV.cooldown>0){
      desc.innerHTML=`Inspecting... <strong>${noteUV.cooldown}s</strong>`;
    }else{
      desc.textContent=clue.description;
      const btn=document.createElement("button");
      btn.textContent="Inspect with UV Lamp";
      btn.onclick=()=>startUV(roomIndex);
      actions.appendChild(btn);
    }
  }else{
    desc.textContent=clue.description;
  }

  document.getElementById("imageModal").classList.add("active");
}

function startUV(roomIndex){
  const noteUV=gameState.roomFlags[roomIndex].noteUV;
  const desc=document.getElementById("modalDescription");

  noteUV.cooldown=120;
  noteUV.interval=setInterval(()=>{
    noteUV.cooldown--;
    desc.innerHTML=`Inspecting... <strong>${noteUV.cooldown}s</strong>`;
    if(noteUV.cooldown<=0){
      clearInterval(noteUV.interval);
      noteUV.revealed=true;
      desc.innerHTML="<strong>Revealed note:</strong> Meet at 15:30";
    }
  },1000);
}

function closeImageModal(){
  document.getElementById("imageModal").classList.remove("active");
}

function showHint(){
  const r=rooms[gameState.currentRoom];
  document.getElementById("hintMsg").textContent=r.hint;
  gameState.hintsUsed++;
  gameState.timeRemaining=Math.max(gameState.timeRemaining-60,0);
  updateSidebar();
}

function updateSidebar(){
  document.getElementById("hintsUsed").textContent=gameState.hintsUsed;
  document.getElementById("progressText").textContent=
    `${Math.round(gameState.solved.size/rooms.length*100)}% Complete`;
  document.getElementById("evidenceList").innerHTML=
    rooms.map(r=>`<div class="evidence-item">
      ${gameState.evidence.has(r.evidence)?"‚úÖ":"üîí"} ${r.evidence}
    </div>`).join("");
}

function showFinalScreen(){
  document.getElementById("gameContainer").innerHTML=`
    <div style="padding:40px;text-align:center">
      <h1 style="color:#16c784">üèÜ Case Closed!</h1>
      <p>You solved ${gameState.solved.size}/${rooms.length} rooms.</p>
      <div class="play-again" onclick="location.reload()">üîÑ Play Again</div>
    </div>`;
}

loadRoom(0);
</script>

</body>
</html>
