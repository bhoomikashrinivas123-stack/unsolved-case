<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Unsolved Case</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Segoe UI,Tahoma,sans-serif;
  background:linear-gradient(135deg,#1a1a2e,#16213e);
  color:#e0e0e0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  max-width:1100px;width:100%;
  background:#0f3460;border-radius:12px;
  display:grid;grid-template-columns:1fr 300px;
  overflow:hidden
}
.main-content{padding:30px}
.sidebar{
  background:#0a1e35;padding:20px;
  border-left:2px solid #e94560
}
h1{color:#e94560}
.room-title{color:#16c784;margin:10px 0}
.visual-clues{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:15px;margin-top:15px
}
.clue-image{
  border:2px solid #16c784;
  border-radius:8px;height:180px;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  cursor:pointer;background:rgba(255,255,255,.1)
}
.timer{
  border:2px solid #e94560;
  padding:10px;border-radius:8px;
  font-family:monospace;margin-bottom:10px
}
input,button{
  padding:10px;margin-top:8px;
  border-radius:6px;border:none
}
button{background:#e94560;color:#fff;cursor:pointer}
.image-modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.9);
  justify-content:center;align-items:center
}
.image-modal.active{display:flex}
.modal-content{
  background:#0f3460;padding:25px;
  border-radius:10px;max-width:500px;
  text-align:center;position:relative
}
.modal-close{
  position:absolute;top:8px;right:8px;
  background:#e94560;color:#fff;
  padding:5px 10px;border-radius:6px
}
.message.success{color:#16c784}
.message.error{color:#e94560}
.play-again{
  margin-top:25px;font-size:28px;
  color:#16c784;cursor:pointer
}
</style>
</head>

<body>

<div class="container" id="gameContainer">
  <div class="main-content">
    <h1>üîç The Unsolved Case</h1>
    <div class="room-title" id="roomTitle"></div>
    <div class="timer" id="timerDisplay"></div>
    <div id="roomContent"></div>
  </div>
  <div class="sidebar">
    <p><strong>Room:</strong> <span id="roomNumber"></span></p>
    <p><strong>Hints:</strong> <span id="hintsUsed">0</span></p>
    <p id="progressText">0% Complete</p>
    <h3>Evidence</h3>
    <div id="evidenceList"></div>
  </div>
</div>

<div class="image-modal" id="imageModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeImageModal()">X</button>
    <div id="modalImage" style="font-size:100px"></div>
    <div id="modalDescription"></div>
    <div id="modalActions"></div>
  </div>
</div>

<script>
let gameState;

const rooms=[
{
 title:"Room 1: Crime Scene",
 timeLimit:300,
 story:"Investigate the clues.",
 visualClues:[
  {emoji:"üìù",desc:"Meet at 1_:3_"},
  {emoji:"üïê",desc:"Clock shows 3:30 PM"},
  {emoji:"üîí",desc:"Safe was opened"},
  {emoji:"üìä",desc:"Security log empty"}
 ],
 answer:"15:30",
 evidence:"Security Log",
 hint:"Clock + Note"
},
{
 title:"Room 2: Suspects",
 timeLimit:180,
 story:"Someone is lying.",
 visualClues:[
  {emoji:"üë®",desc:"Alex left at 3:15"},
  {emoji:"üëÆ",desc:"Ben‚Äôs watch wrong"},
  {emoji:"üë©",desc:"Clara‚Äôs call forwarded"},
  {emoji:"üìπ",desc:"Blurred guard"}
 ],
 answer:"clara",
 evidence:"Phone Records",
 hint:"Compare times"
},
{
 title:"Room 3: Final Code",
 timeLimit:120,
 story:"Unlock the vault.",
 visualClues:[
  {emoji:"üèõ",desc:"One pillar"},
  {emoji:"‚≠ê",desc:"Five points"},
  {emoji:"üî∫",desc:"Three sides"},
  {emoji:"üîê",desc:"Round lock"}
 ],
 answer:"1530",
 evidence:"Confession",
 hint:"Digits from before"
}
];

function resetGame(){
 clearInterval(gameState?.timer);
 gameState={
  room:0,
  solved:new Set(),
  evidence:new Set(),
  hints:0,
  time:0,
  timer:null,
  uv:{active:false,cooldown:0,interval:null,revealed:false}
 };
 loadRoom(0);
}

function loadRoom(i){
 if(i>=rooms.length){finalScreen();return;}
 gameState.room=i;
 gameState.time=rooms[i].timeLimit;
 document.getElementById("roomTitle").textContent=rooms[i].title;
 document.getElementById("roomNumber").textContent=`${i+1}/3`;

 document.getElementById("roomContent").innerHTML=`
 <p>${rooms[i].story}</p>
 <div class="visual-clues">
 ${rooms[i].visualClues.map((c,idx)=>`
  <div class="clue-image" onclick="openClue(${idx})">
   <div style="font-size:50px">${c.emoji}</div>
  </div>`).join("")}
 </div>
 <p>${rooms[i].answer==="1530"?"Enter code":"Answer:"}</p>
 <input id="answerInput">
 <button onclick="submit()">Submit</button>
 <div id="msg"></div>
 `;
 startTimer();
 updateSidebar();
}

function startTimer(){
 clearInterval(gameState.timer);
 gameState.timer=setInterval(()=>{
  gameState.time--;
  document.getElementById("timerDisplay").textContent=`‚è± ${gameState.time}s`;
 },1000);
}

function openClue(idx){
 const modal=document.getElementById("imageModal");
 document.getElementById("modalImage").textContent=rooms[gameState.room].visualClues[idx].emoji;
 const desc=document.getElementById("modalDescription");
 const actions=document.getElementById("modalActions");
 actions.innerHTML="";

 if(gameState.room===0 && idx===0){
  if(gameState.uv.revealed){
   desc.innerHTML="<strong>Meet at 15:30</strong>";
  }else if(gameState.uv.active){
   desc.innerHTML=`Inspecting... ${gameState.uv.cooldown}s`;
  }else{
   desc.textContent="Meet at 1_:3_";
   const b=document.createElement("button");
   b.textContent="Use UV Lamp";
   b.onclick=startUV;
   actions.appendChild(b);
  }
 }else{
  desc.textContent=rooms[gameState.room].visualClues[idx].desc;
 }
 modal.classList.add("active");
}

function startUV(){
 gameState.uv.active=true;
 gameState.uv.cooldown=10;
 gameState.uv.interval=setInterval(()=>{
  gameState.uv.cooldown--;
  if(gameState.uv.cooldown<=0){
   clearInterval(gameState.uv.interval);
   gameState.uv.revealed=true;
   gameState.uv.active=false;
   document.getElementById("modalDescription").innerHTML="<strong>Meet at 15:30</strong>";
  }
 },1000);
}

function closeImageModal(){
 document.getElementById("imageModal").classList.remove("active");
 if(gameState.uv.interval){
  clearInterval(gameState.uv.interval);
  gameState.uv.interval=null;
  gameState.uv.active=false;
 }
}

function submit(){
 const v=document.getElementById("answerInput").value.toLowerCase();
 const m=document.getElementById("msg");
 if(v===rooms[gameState.room].answer){
  m.className="message success";
  m.textContent="Correct!";
  gameState.solved.add(gameState.room);
  gameState.evidence.add(rooms[gameState.room].evidence);
  setTimeout(()=>loadRoom(gameState.room+1),800);
 }else{
  m.className="message error";
  m.textContent="Wrong!";
 }
 updateSidebar();
}

function updateSidebar(){
 document.getElementById("hintsUsed").textContent=gameState.hints;
 document.getElementById("progressText").textContent=
  `${Math.round(gameState.solved.size/3*100)}% Complete`;
 document.getElementById("evidenceList").innerHTML=
  rooms.map(r=>`<div>${gameState.evidence.has(r.evidence)?"‚úÖ":"üîí"} ${r.evidence}</div>`).join("");
}

function finalScreen(){
 document.getElementById("gameContainer").innerHTML=`
 <div style="padding:40px;text-align:center">
  <h1 style="color:#16c784">üèÜ Case Closed!</h1>
  <div class="play-again" onclick="resetGame()">üîÑ Play Again</div>
 </div>`;
}

resetGame();
</script>

</body>
</html>
